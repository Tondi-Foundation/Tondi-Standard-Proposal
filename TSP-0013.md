---
title: "TSP-0013 — GhostDAG Optimization"
description: "Proposal Number: TSP-0013"
---

**Proposal Number:** TSP-0013  
**Proposal Name:** GhostDAG Sorting Optimization  
**Category:** Consensus (C) — _pre-Oct 2025 numbering retained as `000x`_  
**Status:** Draft  
**Author:** Tondi Foundation Development Team & Avato Labs  
**Created:** 2025-09-10  
**Updated:** 2025-09-13  
**Target:** Tondi Frontier (v2026a)  
**Scope:** GhostDAG consensus optimization, block sorting algorithms, performance improvements, DAG ordering efficiency  

---

## Abstract

This proposal enhances the GhostDAG consensus protocol by optimizing blue set selection for high-throughput DAG systems like Tondi. We introduce a local topological approximation layer with randomized sampling, paired with concurrent data structures (skip-lists, Fenwick trees, Roaring bitmaps) and Read-Copy-Update (RCU) snapshots. Combined with VRF-based damping (TSP-0012), this reduces insertion overhead from near-linear to sub-logarithmic, targeting 3–5× throughput gains and 40–60% lower confirmation latencies at 30+ BPS, while preserving GhostDAG's security and eventual consistency.

---

## Background

GhostDAG powers Tondi and Kaspa, enabling parallel block production and approximating the maximum k-cluster subgraph via blue/red coloring. It supports 10–100 blocks per second (BPS) with probabilistic finality, outscaling linear blockchains. However, at high rates (30+ BPS, as targeted with VRF damping in TSP-0012), blue set selection—driven by anticone and k-cluster checks—faces computational bottlenecks. Greedy traversals yield amortized `O(n)` complexity per insertion, inflating CPU usage and p95 confirmation delays to 5–10s in dense DAGs or under network partitions.

Existing optimizations (layered pruning, memoization) are insufficient for sustained 30–50 BPS. This proposal layers heuristic approximations and concurrency primitives atop GhostDAG, synergizing with VRF damping to flatten conflict spikes and accelerate blue set convergence.

---

## Proposal Details

### 1. Approximation-Based Sorting Acceleration

We propose a heuristic fast-path for blue set estimation, bounding computations to recent DAG subsets with verifiable accuracy.

- **Local Topological Approximation**: Restrict anticone and k-cluster analysis to a radius `r` around the new block’s parents and layer anchors. The radius adapts dynamically:  
  `r_t = r_{t-1} + α * (fork_rate_t - θ)`, with `α = 0.1`, `θ = 0.05` (tunable). This caps complexity at `O(r * log n)`, covering 95%+ of relevant forks.

- **Randomized Sampling**: Sample parent-adjacent layers, weighted by PoW scores. Use Bloom filters for `O(1)` membership and Roaring bitmaps for cardinality estimates. Target error `ε < 0.01` with confidence `1 - δ` (`δ = 10^-6`), via Hoeffding bounds:  
  `p̂ ± √(log(2/δ) / 2m)`, where `m ≈ 1000` samples.

- **Representative Set Mechanism**: Maintain top-`d` (e.g., `d=50`) high-score blocks per `Δ_l = 10` layers as query anchors, pruning 80–90% of nodes from consideration.

This shifts 90%+ insertions to fast-paths, deferring exact checks to conflicts, complementing VRF damping’s conflict reduction (TSP-0012).

### 2. Concurrent Data Structure Optimizations

We embed lock-free structures to support multi-threaded validators at scale.

- **Concurrent Skip-List**: Indexes intra-layer blocks by timestamp/score for `O(log n)` queries/insertions. Probabilistic leveling minimizes contention under 1,000+ concurrent readers.

- **Fenwick Tree**: Tracks layer aggregates (e.g., blue counts) for `O(log n)` prefix-sum queries, enabling fast score approximations. Updates are RCU-lazy.

- **Roaring Bitmap**: Encodes sparse past/anticone sets with <1% overhead. Supports `O(m / w + s)` set operations (`m`: bitmap size, `w=64`, `s`: runs), ideal for million-node DAGs.

- **RCU Snapshot Mechanism**: Readers access immutable snapshots via hazard pointers; writers trigger copy-on-write. Epoch-based reclamation ensures 2–4× concurrency gains at read:write >10:1.

Hybrid path: Fast-path for optimistic insertions (95% cases); slow-path for full GhostDAG on errors.

### 3. Security Guarantees

Optimizations are non-invasive overlays, preserving GhostDAG invariants.

- **Provisional Optimism**: Fast-path outputs are hints; slow-path validates via recursive k-cluster coloring and anticone merges, ensuring equivalence.

- **Error Recovery**: Approximation errors (e.g., anticone misestimates) trigger RCPU rollbacks in `O(log n)`, with frequency <0.5% per tuned `ε`, `δ`. Safety: `Pr[error] ≤ ε + δ`.

- **Adaptivity**: Runtime toggles and EMA-based tuning (fork rate, rollbacks) adjust `r`, sampling. Preserves k-cluster resistance to >1/3 adversarial weight and liveness under `Δ`-bounded delays.

Synergy with TSP-0012’s VRF damping reduces conflict spikes, lowering rollback rates by ~40%.

---

## Expected Benefits

| Metric                  | Baseline (GhostDAG) | Optimized (TSP-0013) | Improvement |
|-------------------------|---------------------|----------------------|-------------|
| **Throughput (BPS)**    | 10–100             | 18–500               | 1.8–5×      |
| **p50 Latency**         | 1–2s               | 0.4–1s              | 50–60% ↓    |
| **p95 Latency**         | 5–10s              | 2–4s                | 40–60% ↓    |
| **CPU/BPS**             | 80–100%            | 20–40%              | 2–5×        |
| **Memory Overhead**     | Baseline           | +5–10% (bitmaps)    | Negligible  |

*Projections from Rust simulations (1,000 nodes, 20–150ms RTT, 10–100 BPS, VRF damping synergy).*

- **Compatibility**: Drop-in module; toggleable via config.
- **Degradation**: Auto-fallback if red-block rate >2% or fast-path hit <80%.
- **VRF Synergy**: TSP-0012’s randomized delays cut conflict peaks, boosting fast-path efficiency.

---

## Potential Challenges and Mitigations

1. **Sampling Bias**: Adversarial topologies may skew estimates.  
   **Mitigation**: Use multi-source entropy (RANDAO + VRF seeds from TSP-0012); escalate sampling on variance spikes (>2σ).

2. **Concurrency Overhead**: RCPU copies may bloat under bursts.  
   **Mitigation**: Cap snapshots at 16 epochs; tune for 95%+ fast-path hits via perf profiling.

3. **Adversarial Attacks**: Large anticones force fallbacks.  
   **Mitigation**: Cap parents at 128/block; anomaly detection triggers slow-paths; VRF damping mitigates concurrent bursts.

Memory: Compact bitmaps every 1k blocks; evict stale layers.

---

## Implementation Plan

**Phase 1 (Q4 2025: Lab Validation)**  
- Rust prototype atop Kaspa ref impl.  
- ns-3 simulation: 200–1,000 nodes, 10–100 BPS, 20–150ms RTT.  
- Tune `r`, `ε`; verify misdetection <0.5%.  
- Test VRF damping integration (TSP-0012).

**Phase 2 (Q1 2026: Testnet Rollout)**  
- Dual-path deploy on Tondi devnet; log deviations.  
- Community audit; publish perf dashboards.  
- Optimize synergy with VRF delays (`δ_max = 60ms`).

**Phase 3 (Q2 2026: Mainnet)**  
- Soft-fork via flags; monitor rollback rates.  
- SDK/docs for operators; external audit (e.g., Trail of Bits).

**Timeline**: 6–9 months.

---

## Conclusion

TSP-0013 scales GhostDAG for 30–100+ BPS ecosystems like Tondi, leveraging approximations, concurrency, and VRF damping synergy (TSP-0012) for 3–5× throughput and 40–60% latency reductions. It preserves security, resists attacks, and offers a deployable path to high-performance DAGs. We invite community feedback, simulations, and contributions for refinement and publication.

---

## Appendix: Mathematical Notes

1. **Conflict Reduction with VRF Damping**: From TSP-0012, VRF delays (`δ ∈ [0, δ_max]`) reduce peak concurrency:  
   `C_w = E[max(0, N_w - 1)], N_w ~ Poisson(λ w)`,  
   with `C_w` dropping 30–40% when `δ_max = 60ms`.

2. **Approximation Error**: Sampling error bounded by:  
   `Pr[|p̂ - p| > ε] ≤ 2e^(-2mε^2)`,  
   ensuring reliable blue/red classification with `m=1000`, `ε=0.01`.
